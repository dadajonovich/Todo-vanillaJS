(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function c(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(r){if(r.ep)return;r.ep=!0;const a=c(r);fetch(r.href,a)}})();(function(){const m=localStorage.getItem("tasks");let i=m?JSON.parse(m):[];const c=document.querySelector(".list"),l=document.forms.namedItem("addTask"),r=l.elements.namedItem("taskText"),a=document.querySelector(".list__counter"),u=document.querySelector(".input__text"),T=window.matchMedia("(max-width: 640px)"),b=e=>{e.matches?u.placeholder="???":u.placeholder="Что делать будем?"};T.addEventListener("change",b);const p=()=>{document.activeElement===r?l.classList.add("input__highlight"):l.classList.remove("input__highlight")};r.addEventListener("focus",p),r.addEventListener("blur",p);const h=e=>{e.target instanceof HTMLElement&&e.target.classList.add("list__item-dragging")},E=e=>{e.target instanceof HTMLElement&&e.target.classList.remove("list__item-dragging")},v=e=>{e.preventDefault();const t=c.querySelector(".list__item-dragging"),n=e.target;if(!(t!==n&&n.classList.contains("list__item"))||!t)return;const s=n===t.nextElementSibling?n.nextElementSibling:n;c.insertBefore(t,s)},w=()=>{const e=[];c.querySelectorAll(".list__item").forEach(n=>{const o=n.getAttribute("data-task-id"),s=i.find(d=>d._id===o);s&&e.push(s)}),i=[...e],g(i)};c.addEventListener("dragover",v),c.addEventListener("dragend",w);const y=(e,t)=>{try{if(!e)throw new Error("Нет задач!");const n=document.createDocumentFragment();return Object.values(e).forEach(o=>{const s=t(o);s.addEventListener("dragstart",d=>h(d)),s.addEventListener("dragend",d=>E(d)),n.append(s)}),c.append(n),!0}catch(n){return console.log(n.message),n}},L=({_id:e,body:t})=>{const n=document.createElement("li");n.classList.add("list__item"),n.setAttribute("data-task-id",e),n.setAttribute("draggable","true");const o=document.createElement("div");o.classList.add("list__task");const s=document.createElement("p");s.classList.add("list__text"),s.textContent=t;const d=document.createElement("span");return d.classList.add("list__delete-btn"),d.insertAdjacentHTML("afterbegin","&#10006;"),o.append(s,d),n.append(o),n};y(i,L);const k=e=>{try{const{value:t}=e;if(!t)throw new Error("Пустой input - код остановлен!");return l.reset(),t}catch(t){throw confirm("Нет дел - нет проблем!"),console.log(t),t}},S=e=>t=>{const n={body:t,completed:!1,_id:`task-${Math.random()}`},o=e(n);return o.addEventListener("dragstart",s=>h(s)),o.addEventListener("dragend",s=>E(s)),c.prepend(o),n},I=e=>{const t=[e,...i];return i=[...t],t},g=e=>{try{return localStorage.setItem("tasks",JSON.stringify(e)),e}catch{throw new Error("Произошла ошибка в changeLocalStorage")}},f=e=>{const t=Object.keys(e).length;t!==0?a.textContent=`${t} items`:a.textContent="Безделье это игрушка дьявола..."};document.addEventListener("DOMContentLoaded",e=>f(i));const _=(...e)=>t=>e.reduce((n,o)=>o(n),t),O=_(k,S(L),I,g,f),M=e=>(e.preventDefault(),O(r));l.addEventListener("submit",M);const x=_(({target:e})=>{if(!(e instanceof HTMLElement))throw new Error("Target не является HTMLElement");if(!e.classList.contains("list__delete-btn"))throw new Error("Событие не на кнопке удаления!");const t=e.closest("[data-task-id]");if(!(t instanceof HTMLElement))throw new Error("Parent не является HTMLElement");return{id:t.dataset.taskId,parent:t}},({id:e,parent:t})=>{if(!confirm("С глаз долой?"))throw new Error("Удаление не было подтверждено в delTask");const o=i.filter(s=>s._id!==e);return t.remove(),i=[...o],o},g,f);c.addEventListener("click",x)})();
